package com.daryl.thesis.loader;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Set;

import me.prettyprint.cassandra.serializers.StringSerializer;
import me.prettyprint.cassandra.service.CassandraHostConfigurator;
import me.prettyprint.hector.api.Cluster;
import me.prettyprint.hector.api.Keyspace;
import me.prettyprint.hector.api.beans.HColumn;
import me.prettyprint.hector.api.beans.OrderedRows;
import me.prettyprint.hector.api.beans.Row;
import me.prettyprint.hector.api.factory.HFactory;
import me.prettyprint.hector.api.query.QueryResult;
import me.prettyprint.hector.api.query.RangeSlicesQuery;


public class FetchDataFixedColumns 
{

	public static void main(String args[])
	{
		Set<String> doubleValues = new HashSet<String>();
		Set<String> longValues = new HashSet<String>();
		Set<String> integerValues = new HashSet<String>();
		
		doubleValues.add("Price");
		doubleValues.add("Value");
		doubleValues.add("Old_Price");
		
		longValues.add("Time");
		longValues.add("Trans_ID");
		longValues.add("Bid_ID");
		longValues.add("Ask_ID");
		longValues.add("Buyer_Broker_ID");
		longValues.add("Seller_Broker_ID");
		
		integerValues.add("Date");
		integerValues.add("Volume");
		integerValues.add("Undisclosed_Volume");
		integerValues.add("Old_Volume");
		
		String keySpaceName = "TIME_SERIES_DATA";
		String columnFamilyName = "DATA";
		CassandraHostConfigurator chc = new CassandraHostConfigurator(
				"localhost");
		Cluster cluster = HFactory.getOrCreateCluster("Test Cluster", chc);

		Keyspace keyspace = HFactory.createKeyspace(keySpaceName, cluster);
		
		
		RangeSlicesQuery<String, String, String> rangeQuery = HFactory.createRangeSlicesQuery(keyspace, StringSerializer.get(), StringSerializer.get(), StringSerializer.get());
		rangeQuery.setColumnFamily(columnFamilyName);
		rangeQuery.setKeys("ABC20120831000000000", "ABC2012083108640000");
		rangeQuery.setRange(null, null, false, 20);
		rangeQuery.setRowCount(14624);
		QueryResult<OrderedRows<String, String, String>> result = rangeQuery.execute();
		
		OrderedRows<String, String, String> rows =  result.get();
		
		Iterator<Row<String, String, String>> iterator = rows.iterator();
		int i = 0;
		while(iterator.hasNext())
		{
			++i;
			Row<String, String, String> r = iterator.next();
			System.out.println(r.getKey() + ":");
			for( HColumn<String, String> c :r.getColumnSlice().getColumns())
			{
				if(doubleValues.contains(c.getName()))
				{
					
					System.out.println( c.getName() + ": " + c.getValueBytes().getDouble());
				}
				else if(integerValues.contains(c.getName()))
				{
					System.out.println( c.getName() + ": " + c.getValueBytes().getInt());
				}
				else if(longValues.contains(c.getName()))
				{
					System.out.println( c.getName() + ": " + c.getValueBytes().getLong());
				}
				else
				{
					System.out.println( c.getName() + ": " + c.getValue());
				}
				
			}
			System.out.println("-----------------------------------");
			
		}
		System.out.println(i);
		
		
	}
}
